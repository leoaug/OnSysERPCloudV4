<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                template="/WEB-INF/template.xhtml">

    <ui:define name="title">SEG0104 - Programa</ui:define>
    <ui:define name="content">
        <style>
            .ui-menu {
                min-width: 300px;
            }                    
        </style>
        <style> 
            .ui-datatable .ui-datatable-data .even-row td{
                background-color: #EEF5FF;                          
                font-size: 12px; 
                height: 10px;  
            }
            .ui-datatable .ui-datatable-data .odd-row td{
                background-color:#E8EDF0;
                font-size: 12px; 
                height: 10px;                         
            }                    
        </style>        
        <h:form id="form">
            <div class="grid crud-demo">
                <div class="col-12">
                    <div class="card">                 
                    	<p:growl id="messages" showDetail="true"/>
                        <p:toolbar styleClass="mb-4" id="toolbar">
                            <p:toolbarGroup>
                                <p:commandButton value="Novo" 
                                                 icon="pi pi-plus" 
                                                 title="Incluir um novo registro."
                                                 actionListener="#{empresaFace.incluir}"
                                                 update="manageDialog,dataView" 
                                                 oncomplete="PF('manageDialog').show()"
                                                 style="text-align: center; width: 100px;margin-right: .5rem"
                                                 styleClass="ui-button-success"/>
                                <span class="ui-separator">
                                    <span class="pi pi-ellipsis-v leaden"/>
                                </span>
                                <p:menuButton style="text-align: center; width: 140px;margin-right: .5rem"
                                              value="Mais opções">  
                                    <c:if test="#{!favoritosFace.validaExistente()}">
                                        <p:menuitem value="Adicionar aos favoritos" 
                                                    icon="pi pi-star" 
                                                    update="toolbar"
                                                    actionListener="#{favoritosFace.criaFavorito(usuarioFace.loggedUser.empresa.codigo)}"/>
                                    </c:if>
                                    <c:if test="#{favoritosFace.validaExistente()}">
                                        <p:menuitem value="Remover dos favoritos" 
                                                    icon="pi pi-star-fil" 
                                                    update="toolbar"
                                                    actionListener="#{favoritosFace.deletaFavorito()}"/>
                                    </c:if>                                    
                                    <p:menuitem value="Ajuda" icon="pi pi-question"/>
                                </p:menuButton> 
                                <p:spacer width="3" height="3"/>  
                                <p:commandButton id="limparFiltro"
                                                 title="Atualizar lista e limpar pesquisa"
                                                 style="text-align: center; width: 30px;margin-right: .5rem"
                                                 actionListener="#{empresaFace.limparFiltros}"
                                                 icon="pi pi-bolt Fs14 white"
                                                 update="dataView,toolbar">
                                    <p:resetInput target="dataView"/>
                                </p:commandButton>                                
                            </p:toolbarGroup>
                            <p:toolbarGroup align="right">
                                <p:commandButton value="Exportar" 
                                                 icon="pi pi-upload" 
                                                 styleClass="ui-button-help" 
                                                 ajax="false" style="text-align: center; width: 100px;margin-right: .5rem">
                                    <p:dataExporter type="xls" target="form:dataView" postProcessor="#{postProcessXLS.postProcessXLS}" fileName="SPR0103"/>
                                </p:commandButton>
                            </p:toolbarGroup>
                        </p:toolbar>
                        
                        
                    
                    	<h:panelGrid columns="2" style="margin-bottom: 20px;">
				            <h:outputLabel value="Filtro:" />
				            <p:inputText value="#{empresaFace.filtroTexto}" placeholder="Informe o Filtro">
				                <p:ajax event="keyup" update="dataView" listener="#{empresaFace.filter}" />
				            </p:inputText>
        				</h:panelGrid>

				        <p:dataView id="dataView" 
				        			value="#{empresaFace.filteredEmpresas}" 
				        			var="registro" 
				        			gridIcon="pi pi-th-large" 
				        			listIcon="pi pi-bars">
				          
				          				          
				            <f:facet name="header">
                                <div class="products-table-header">
                                    <span style="font-weight: bold">SEG0104 - Empresa</span>                               
                                </div>
                            </f:facet>
				          
				          	<p:dataViewGridItem>
				          		 <p:panel style="text-align:center">
				          		 	 <p:graphicImage value="#{registro.logotop}"/>
				          		 	 <br />
				          		 	 <h:outputText value="Descrição: #{registro.descricao}" />
				          		 	 <br />
				          		 	 <h:outputText value="Código: #{registro.codigo}" /> 
				          		 	 <br /> <br />
				          		 	 <div class="grid crud-demo">
                						<div class="col-12">	
                							<p:commandButton icon="pi pi-pencil" 
							                     title="Alterar registro selecionado."
							                     update=":form:manage-registro-content,:form:manageDialog" 
							                     oncomplete="PF('manageDialog').show()"
							                     action="#{empresaFace.alterar}" 
							                     styleClass="edit-button rounded-button ui-button-success"
							                     process="@this">
							        			<f:setPropertyActionListener value="#{registro}" target="#{empresaFace.registroSelecionado}"/>
    										</p:commandButton>
										    <p:commandButton icon="pi pi-eye" 
										                     title="Consultar registro selecionado."                                                 
										                     update=":form:manage-registro-contentConsulta,:form:manageDialogConsulta"                                                  
										                     oncomplete="PF('manageDialogConsulta').show()"
										                     action="#{empresaFace.consultar()}" 
										                     styleClass="ui-button-info rounded-button mr-2 mb-2"
										                     process="@this">
										        <f:setPropertyActionListener value="#{registro}" target="#{empresaFace.registroSelecionado}"/>
										    </p:commandButton>
										    <p:commandButton class="ui-button-warning rounded-button" 
										                     icon="pi pi-trash" 
										                     title="Deletar registro selecionado."
										                     process="@this" 
										                     oncomplete="PF('deleteProductDialog').show()" >
										        <f:setPropertyActionListener value="#{registro}" target="#{empresaFace.registroSelecionado}"/>
										    </p:commandButton>	
                						</div>
                					 </div>
				          		 	 
				          		 </p:panel>
				          		 		          	
				          	</p:dataViewGridItem>
				          
				          	<p:dataViewListItem>
				          		
				          		
				          		
				          		<div class="grid crud-demo">
                					<div class="col-3">
                						<p:graphicImage value="#{registro.logotop}"/>
                					</div>
                					<div class="col-3">
                						<h:outputText value="Descrição:" />              						
                						<h:outputText value="#{registro.descricao}" style="font-weight:bold" />
                					</div>
                					<div class="col-3">
        								<h:outputText value="Código:" />               							
                						<h:outputText value="#{registro.codigo}" />                						
                					</div>
                					<div class="col-3">
                						<p:commandButton icon="pi pi-pencil" 
							                     title="Alterar registro selecionado."
							                     update=":form:manage-registro-content,:form:manageDialog" 
							                     oncomplete="PF('manageDialog').show()"
							                     action="#{empresaFace.alterar()}" 
							                     styleClass="edit-button rounded-button ui-button-success"
							                     process="@this">
							        		<f:setPropertyActionListener value="#{registro}" target="#{empresaFace.registroSelecionado}"/>
    									</p:commandButton>
									    <p:commandButton icon="pi pi-eye" 
									                     title="Consultar registro selecionado."                                                 
									                     update=":form:manage-registro-contentConsulta,:form:manageDialogConsulta"                                                  
									                     oncomplete="PF('manageDialogConsulta').show()"
									                     action="#{empresaFace.consultar()}" 
									                     styleClass="ui-button-info rounded-button mr-2 mb-2"
									                     process="@this">
									        <f:setPropertyActionListener value="#{registro}" target="#{empresaFace.registroSelecionado}"/>
									    </p:commandButton>
									    <p:commandButton class="ui-button-warning rounded-button" 
									                     icon="pi pi-trash" 
									                     title="Deletar registro selecionado."
									                     process="@this" 
									                     oncomplete="PF('deleteProductDialog').show()" >
									        <f:setPropertyActionListener value="#{registro}" target="#{empresaFace.registroSelecionado}"/>
									    </p:commandButton>
                					</div>
                				</div>
				          	
				          		<br/>
				          		<p:separator />
				          					          	
				          	</p:dataViewListItem>
				          					          				          
				        </p:dataView>
				        
			            <p:dialog id="manageDialog"
                                 header="#{empresaFace.titulo}"
                                 style="max-width: 1000px!important"
                                 width="90%" height="90%"
                                 showEffect="fade" 
                                 modal="true" 
                                 widgetVar="manageDialog" 
                                 responsive="true">
	                           	<p:outputPanel rendered="#{not empty empresaFace.registroSelecionado}" id="manage-registro-content"  class="ui-fluid">
	                           
		                           	<c:choose>
	                                    <c:when test="#{empresaFace.operacao == 'A'}">
	                                        <p:focus for="descricaoInterna"/>
	                                    </c:when>
	                                    <c:otherwise>
	                                        <p:focus for="codigo"/>
	                                    </c:otherwise>
	                                </c:choose>
	                                <div class="field">
	                                    <c:choose>
	                                        <c:when test="#{empresaFace.operacao == 'A'}">
	                                            <p:outputLabel style="color: black" for="codigo">Código</p:outputLabel>
	                                            <p:inputText id="codigo"
	                                                         disabled="true"
	                                                         style="color: blue; font-weight: 700; opacity: 1!important"
	                                                         value="#{empresaFace.registroSelecionado.codigo}"/>
	                                        </c:when>
	                                        <c:otherwise>
	                                            <p:outputLabel style="color: red" for="codigo">Código</p:outputLabel>
	                                            <p:inputText id="codigo" 
	                                                         value="#{empresaFace.registroSelecionado.codigo}"/>
	                                        </c:otherwise>
	                                    </c:choose>
	                                </div>
	                                <div class="field">
	                                    <p:outputLabel style="color: red" for="descricaoInterna">Decrição interna</p:outputLabel>
	                                    <p:inputText id="descricaoInterna" 
	                                                     value="#{empresaFace.registroSelecionado.descricao}"/>
	                                </div>
	                           
	                           	</p:outputPanel>
	                           	
	                           	 <f:facet name="footer">
	                                <c:if test="#{empresaFace.operacao == 'A'}">
	                                    <c:if test="#{empresaFace.getInativo() == 'S'}">
	                                        <h:outputText value="Registro inativado em - #{empresaFace.registroSelecionado.datainativo}" 
	                                                      style="color: red; font-weight: 700; opacity: 1!important">
	                                            <f:convertDateTime pattern="dd/MM/yyyy" timeZone="America/Sao_Paulo"/>
	                                        </h:outputText>
	                                    </c:if>
	                                </c:if>                                        
	                                <p:spacer width="30" height="30"/>
	                                <h:outputText value="Campo(s) obrigatório(s)." style="color: red; font-weight: 700"/>
	                                <p:spacer width="30" height="30"/>
	                                <p:commandButton value="Salvar" 
	                                                 style="text-align: center; width: 100px;margin-right: .5rem"
	                                                 icon="pi pi-check" 
	                                                 action="#{empresaFace.salvar(false)}" 
	                                                 update="manage-registro-content" process="manage-registro-content @this"/>
	                                <c:if test="#{empresaFace.operacao == 'I'}">
	                                    <p:commandButton value="Salvar e novo" 
	                                                     style="text-align: center; width: 125px;margin-right: .5rem"
	                                                     action="#{empresaFace.salvar(true)}" 
	                                                     update="manage-registro-content" 
	                                                     process="manage-registro-content @this"/>
	                                </c:if>
	                                <c:if test="#{empresaFace.operacao == 'A'}">
	                                    <c:if test="#{empresaFace.getInativo() == 'N'}">
	                                        <p:commandButton immediate="true" title="Inativar"
	                                                         style="text-align: center; width: 100px;margin-right: .5rem"
	                                                         value="Inativar"
	                                                         class="ui-button-danger"                                                         
	                                                         process="manage-registro-content @this"
	                                                         action="#{empresaFace.inativar()}" alt="Inativar" icon="pi pi-lock white"/>
	                                    </c:if>
	                                    <c:if test="#{empresaFace.getInativo() == 'S'}">
	                                        <p:commandButton immediate="true" title="Ativar" 
	                                                         action="#{empresaFace.ativar()}" alt="Ativar" 
	                                                         style="text-align: center; width: 100px;margin-right: .5rem"
	                                                         process="manage-registro-content @this"
	                                                         value="Ativar"
	                                                         class="ui-button-success"
	                                                         icon="pi pi-unlock white"/>
	                                    </c:if>
	
	                                </c:if>
	                                <p:commandButton value="Cancelar" 
	                                                 style="text-align: center; width: 100px;margin-right: .5rem"
	                                                 icon="pi pi-times" 
	                                                 onclick="PF('manageDialog').hide()" 
                                                 	 class="ui-button-secondary"/>
                            </f:facet>
                         </p:dialog>
                         
                         <p:confirmDialog widgetVar="deleteProductDialog" showEffect="fade" width="300" message="Deletar registro(s)?" header="Confirmação" severity="warn">
                            <p:commandButton value="Sim" icon="pi pi-check" actionListener="#{empresaFace.remover()}" process="@this" oncomplete="PF('deleteProductDialog').hide()"/>
                            <p:commandButton value="Não" type="button" styleClass="ui-button-secondary" icon="pi pi-times" onclick="PF('deleteProductDialog').hide()" />
                         </p:confirmDialog>

                         <p:confirmDialog global="true" showEffect="fade" width="300">
                            <p:commandButton value="Sim" type="button" styleClass="ui-confirmdialog-yes" icon="pi pi-check" />
                            <p:commandButton value="Não" type="button" styleClass="ui-confirmdialog-no ui-button-secondary" icon="pi pi-times" />
                         </p:confirmDialog>
                        
                         <p:dialog id="manageDialogConsulta"
                                  header="#{empresaFace.titulo}"
                                  style="max-width: 1000px!important"
                                  width="90%" height="90%"
                                  showEffect="fade" 
                                  modal="true" 
                                  widgetVar="manageDialogConsulta" 
                                  responsive="true">
	                            <p:outputPanel rendered="#{not empty empresaFace.registroSelecionado}" id="manage-registro-contentConsulta" class="ui-fluid">
	                               
	                              
	                                <div class="field">	                             
	                                     <p:graphicImage id="logotop" value="#{empresaFace.registroSelecionado.logotop}"/>
	                                </div>
	                               
	                               <div class="field">
	                                    <p:outputLabel style="color: black" for="codigoConsulta">Código</p:outputLabel>
	                                    <p:inputText id="codigoConsulta"
	                                                 disabled="true"
	                                                 style="color: blue; font-weight: 700; opacity: 1!important"
	                                                 value="#{empresaFace.registroSelecionado.codigo}"/>
	                                </div>
	                                <div class="field">
	                                    <p:outputLabel style="color: black" for="descricaoInternaConsulta">Decrição</p:outputLabel>
	                                    <p:inputText id="descricaoInternaConsulta"
	                                                 disabled="true"
	                                                 style="color: blue; font-weight: 700; opacity: 1!important"
	                                                 value="#{empresaFace.registroSelecionado.descricao}"/>
	                                </div>
	                            </p:outputPanel>
                        </p:dialog>
                    
                    </div>
                 </div>
             </div>
        </h:form>
    </ui:define>
 </ui:composition>