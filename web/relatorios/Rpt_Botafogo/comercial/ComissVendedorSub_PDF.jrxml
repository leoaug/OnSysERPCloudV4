<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="ComissVendedorSub_PDF" pageWidth="595" pageHeight="842" columnWidth="555" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20">
	<property name="ireport.zoom" value="1.0"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<style name="zebra" isDefault="false" forecolor="#FFFFFF">
		<conditionalStyle>
			<conditionExpression><![CDATA[new Boolean($V{REPORT_COUNT}.intValue() % 2 == 0)]]></conditionExpression>
			<style isDefault="false" style="zebra" mode="Opaque" forecolor="#FFFFFF" backcolor="#CCFFFF"/>
		</conditionalStyle>
	</style>
	<parameter name="pDataIni" class="java.lang.String"/>
	<parameter name="cCondicao2" class="java.lang.String"/>
	<parameter name="cCondicao3" class="java.lang.String"/>
	<parameter name="comissao2" class="java.math.BigDecimal"/>
	<parameter name="represSub" class="java.lang.String"/>
	<queryString>
		<![CDATA[SELECT comissaotpmov.`DESCRICAO`,
       comissaomovto.`DTMOVTO`,
       CASE WHEN  (comissaotpmov.`TIPO` = 'Saida' or
                   comissaotpmov.`TIPO` = 'Despesa' or
                   comissaotpmov.`TIPO` = 'Desconto') THEN (-1 * comissaomovto.`VLMOVTO`)
       ELSE comissaomovto.`VLMOVTO` END AS VLMOVTO,
       represDesp.`NOME` AS represDesp_NOME,
       (select SUM(pedidovendas.`VLTOTPEDIDO` * (pedidovendas.`PERCCOMISSAO` / 100))
     FROM
     `pedidovendas` pedidovendas INNER JOIN `participante` participante ON pedidovendas.`CLIENTE_id` = participante.`id`
     INNER JOIN `representante` representante ON pedidovendas.`REPRESENTANTE_id` = representante.`id`
     LEFT JOIN `metapremiorepres` metapremiorepres ON metapremiorepres.`representante_id` = representante.`id` and
                                   metapremiorepres.ano = year($P{pDataIni}) and metapremiorepres.mes = month($P{pDataIni})
     INNER JOIN `empresa` empresa ON empresa.`id` = pedidovendas.`EMPRESA_id`
     LEFT OUTER JOIN `usuario` usuario ON representante.`USUARIOREP_id` = usuario.id
$P!{cCondicao2}) as Comissao
  FROM
  `comissaomovto` comissaomovto INNER JOIN `comissaotpmov` comissaotpmov ON `COMISSAOTPMOV_id` = comissaotpmov.`id`
   INNER JOIN `representante` represDesp ON comissaomovto.`REPRESENTANTE_id` = represDesp.`id`
$P!{cCondicao3}
ORDER BY represDesp_NOME, comissaomovto.`DTMOVTO`]]>
	</queryString>
	<field name="DESCRICAO" class="java.lang.String"/>
	<field name="DTMOVTO" class="java.sql.Date"/>
	<field name="VLMOVTO" class="java.math.BigDecimal"/>
	<field name="represDesp_NOME" class="java.lang.String"/>
	<field name="Comissao" class="java.math.BigDecimal"/>
	<variable name="totDesp" class="java.math.BigDecimal" resetType="Group" resetGroup="Representante" calculation="Sum">
		<variableExpression><![CDATA[$F{VLMOVTO}]]></variableExpression>
	</variable>
	<variable name="totReceber" class="java.lang.Double" resetType="Group" resetGroup="Representante">
		<variableExpression><![CDATA[($P{comissao2}.floatValue()+$V{totDesp}.doubleValue())]]></variableExpression>
	</variable>
	<group name="Representante" isReprintHeaderOnEachPage="true">
		<groupExpression><![CDATA[$F{represDesp_NOME}]]></groupExpression>
		<groupHeader>
			<band height="20">
				<staticText>
					<reportElement x="0" y="0" width="61" height="20"/>
					<textElement verticalAlignment="Middle">
						<font size="7" isBold="true"/>
					</textElement>
					<text><![CDATA[Representante:]]></text>
				</staticText>
				<textField>
					<reportElement x="61" y="0" width="332" height="20"/>
					<textElement verticalAlignment="Middle">
						<font size="7" isBold="true"/>
					</textElement>
					<textFieldExpression class="java.lang.String"><![CDATA[$F{represDesp_NOME}]]></textFieldExpression>
				</textField>
			</band>
		</groupHeader>
		<groupFooter>
			<band height="70">
				<line>
					<reportElement x="293" y="1" width="100" height="1"/>
				</line>
				<textField pattern="#,##0.00;-#,##0.00" isBlankWhenNull="true">
					<reportElement x="293" y="2" width="100" height="20"/>
					<textElement textAlignment="Right" verticalAlignment="Middle">
						<font size="7" isBold="true"/>
					</textElement>
					<textFieldExpression class="java.math.BigDecimal"><![CDATA[$V{totDesp}]]></textFieldExpression>
				</textField>
				<staticText>
					<reportElement x="204" y="2" width="89" height="20"/>
					<textElement textAlignment="Right" verticalAlignment="Middle">
						<font size="7" isBold="true"/>
					</textElement>
					<text><![CDATA[Total outros:]]></text>
				</staticText>
				<staticText>
					<reportElement x="204" y="22" width="89" height="20"/>
					<textElement textAlignment="Right" verticalAlignment="Middle">
						<font size="7" isBold="true"/>
					</textElement>
					<text><![CDATA[Total da comissão :]]></text>
				</staticText>
				<line>
					<reportElement x="293" y="42" width="100" height="1"/>
				</line>
				<textField pattern="#,##0.00;-#,##0.00" isBlankWhenNull="true">
					<reportElement x="293" y="43" width="100" height="20"/>
					<textElement textAlignment="Right" verticalAlignment="Middle">
						<font size="7" isBold="true"/>
					</textElement>
					<textFieldExpression class="java.lang.Double"><![CDATA[$V{totReceber}]]></textFieldExpression>
				</textField>
				<staticText>
					<reportElement x="204" y="43" width="89" height="20"/>
					<textElement textAlignment="Right" verticalAlignment="Middle">
						<font size="7" isBold="true"/>
					</textElement>
					<text><![CDATA[Total a receber :]]></text>
				</staticText>
				<textField pattern="#,##0.00;-#,##0.00" isBlankWhenNull="true">
					<reportElement x="293" y="22" width="100" height="20"/>
					<textElement textAlignment="Right" verticalAlignment="Middle">
						<font size="7" isBold="true"/>
					</textElement>
					<textFieldExpression class="java.math.BigDecimal"><![CDATA[$P{comissao2}]]></textFieldExpression>
				</textField>
			</band>
		</groupFooter>
	</group>
	<background>
		<band splitType="Stretch"/>
	</background>
	<title>
		<band splitType="Stretch"/>
	</title>
	<pageHeader>
		<band height="20" splitType="Stretch">
			<staticText>
				<reportElement x="0" y="0" width="393" height="20"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[OUTROS LANÇAMENTOS]]></text>
			</staticText>
		</band>
	</pageHeader>
	<columnHeader>
		<band height="21" splitType="Stretch">
			<staticText>
				<reportElement mode="Opaque" x="0" y="0" width="217" height="20" backcolor="#CCCCCC"/>
				<textElement verticalAlignment="Middle">
					<font size="7" isBold="true"/>
				</textElement>
				<text><![CDATA[Descrição]]></text>
			</staticText>
			<staticText>
				<reportElement mode="Opaque" x="217" y="0" width="76" height="20" backcolor="#CCCCCC"/>
				<textElement verticalAlignment="Middle">
					<font size="7" isBold="true"/>
				</textElement>
				<text><![CDATA[Data]]></text>
			</staticText>
			<staticText>
				<reportElement mode="Opaque" x="293" y="0" width="100" height="20" backcolor="#CCCCCC"/>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font size="7" isBold="true"/>
				</textElement>
				<text><![CDATA[Valor]]></text>
			</staticText>
			<line>
				<reportElement x="0" y="20" width="393" height="1"/>
			</line>
		</band>
	</columnHeader>
	<detail>
		<band height="15" splitType="Stretch">
			<textField isBlankWhenNull="true">
				<reportElement style="zebra" mode="Opaque" x="0" y="0" width="217" height="15" forecolor="#000000"/>
				<textElement verticalAlignment="Middle">
					<font size="7"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{DESCRICAO}]]></textFieldExpression>
			</textField>
			<textField pattern="dd/MM/yyyy" isBlankWhenNull="true">
				<reportElement style="zebra" mode="Opaque" x="217" y="0" width="76" height="15" forecolor="#000000"/>
				<textElement verticalAlignment="Middle">
					<font size="7"/>
				</textElement>
				<textFieldExpression class="java.util.Date"><![CDATA[$F{DTMOVTO}]]></textFieldExpression>
			</textField>
			<textField pattern="#,##0.00;-#,##0.00" isBlankWhenNull="true">
				<reportElement style="zebra" mode="Opaque" x="293" y="0" width="100" height="15" forecolor="#000000"/>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font size="7"/>
				</textElement>
				<textFieldExpression class="java.math.BigDecimal"><![CDATA[$F{VLMOVTO}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<columnFooter>
		<band splitType="Stretch"/>
	</columnFooter>
	<pageFooter>
		<band splitType="Stretch"/>
	</pageFooter>
	<summary>
		<band splitType="Stretch"/>
	</summary>
</jasperReport>
